{% extends "base.html" %}

    {% block title %}<title>Inicio de Sesi√≥n</title>{% endblock %}

    {% block main %}
        <main>
            <section class="registrarMascota">
                <h2>Registro de Mascotas</h2>
                <form method="post" action="/registrar" onsubmit="registrar(); return false;">
                    <label for="tipo">Tipo de Mascotas</label>
                    <select name="ftipo" id="tipo" required>
                        <option value="">Selecciona el tipo</option>
                        <option value="perro">Perro</option>
                        <option value="gato">Gato</option>
                        <option value="otro">Otro</option>
                    </select>
                    <select name="fraza" id="razas">
                        <option value="">Selecciona la raza</option>
                    </select>
                    <label for="sexo">Sexo</label>
                    <select name="fsexo" id="sexo" required>
                        <option value="">Selecciona el sexo</option>
                        <option value="macho">Masculino</option>
                        <option value="hembra">Femenino</option>
                    </select>
                    <label for="detalles">Detalles</label>
                    <textarea name="fdetalles" id="detalles" placeholder="Describa los detalles de la mascota" required></textarea>
                    <label for="zona">Zona</label>
                    <input type="text" name="fzona" id="zona" required>
                    <label for="calle">Calle</label>
                    <input type="text" name="fcalle" id="calle" required>
                    <label for="altura">Altura</label>
                    <input type="text" name="faltura" id="altura" required>
                    <button type="submit">Registrar</button>
                </form>
            </section>
            <script src="{{ url_for('static', filename='/script/completarBuscardor.js') }}"></script>
            <script>
                document.addEventListener("DOMContentLoaded", function() {
                    var token = localStorage.getItem('token');
                    if (!token) {
                        window.location.href = "/login";
                    } else {
                        console.log(token);
                    }
                });

                function registrar(){
                    var token = localStorage.getItem('token');
                    if (!token) {
                        window.location.href = "/login";
                    } else {
                        var tipo = document.getElementById('tipo').value;
                        var raza = document.getElementById('razas').value;
                        var sexo = document.getElementById('sexo').value;
                        var detalles = document.getElementById('detalles').value;
                        var zona = document.getElementById('zona').value;
                        var calle = document.getElementById('calle').value;
                        var altura = document.getElementById('altura').value;

                        fetch('/registrar', {
                            method: 'POST',
                            headers: {
                                'autorizacion': token,
                                'ftipo': tipo,
                                'fraza': raza,
                                'fsexo': sexo,
                                'fdetalles': detalles,
                                'fzona': zona,
                                'fcalle': calle,
                                'faltura': altura
                            }
                        })
                        .then(response => {
                            //print(response.status)
                            if (response.status === 200) { 
                                window.location.href = "/";
                            } else {  
                                window.location.href = "/registrar";
                            }
                        });
                    }
                }
            </script>
        </main>
    {% endblock %}

